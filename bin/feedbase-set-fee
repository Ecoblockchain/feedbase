#!/usr/bin/env node
var feedbase = require("../lib/feedbase.js")
var wait = require("../lib/wait.js")
var web3 = require("../lib/web3.js")

var [id, value] = process.argv.slice(2)

if (feedbase.isAlwaysFree(id)) {
  console.error(`error: cannot set fee of non-paid feed`)
  process.exit(1)
}

console.log(`set-fee`)
console.log(`id          ${id}`)
console.log(`fee         ${value}`)

wait(x => {
  return x == id
    && web3.toDecimal(feedbase.getFee(id)) == value
}, id => {
  console.log("ok")
}, () => {
  console.error("error: failed to set fee (operation timed out)")
  process.exit(1)
})

feedbase.setFee(id, value)
